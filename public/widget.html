<!-- This is a static file -->
<!-- served from your routes in server.js -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>WXSD Guest Link Generator Widget</title>
    <meta name="description" content="A cool thing made with Webex Teams and Glitch">
    <link rel="icon" type="image/png" href="images/favicon.ico"/>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="css/momentum-ui.min.css">
    <link rel="stylesheet" href="css/momentum-ui-icons.min.css">
    <link rel="stylesheet" href="css/collab-ui.min.css">
    <link rel="stylesheet" href="css/collab-ui-icons.min.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
      $( function() {
        $( "#dialog" ).dialog({
          width: 700,
          height: 500
        });
      } );
    </script>

    <!-- import Cisco Webex Teams Widget library -->
    <script src="https://code.s4d.io/widget-space/production/bundle.js"></script>
    <link rel="stylesheet" href="https://code.s4d.io/widget-space/production/main.css">

    <!-- cookie parser for JS-->
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>

  </head>
  <body style="background-size: cover;">
    <header>
    </header>
      <div id="dialog" title=".">
        <div id="my-ciscospark-widget"></div>
      </div>

    <script>
      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);

      const defaultBackground = 'https://cdn.glitch.com/e627e173-ddba-434f-ad34-e11549d64430%2F1_Ud5vq4XLOohhVKT1Nv94NQ.png?v=1585690687557'
      const useBackground = urlParams.get('backgroundImage') == null ? defaultBackground : urlParams.get('backgroundImage');

      const destination = urlParams.get('destination') == null ? Cookies.get('target') : urlParams.get('destination');
      const destinationType = urlParams.get('destinationType') == null ? Cookies.get('destinationType') : urlParams.get('destinationType');
      const token = urlParams.get('token') == null ? Cookies.get('token') : urlParams.get('token');
      let label = urlParams.get('label') == null ? Cookies.get('label') : urlParams.get('label');
      if(label == undefined){
        label = "User";
      }
      console.log(destination);
      console.log(destinationType);
      console.log(token);

      $('body').css({'background-image':`url(${useBackground})`});

      var widgetEl = document.getElementById('my-ciscospark-widget');
      const userType = Cookies.get("userType");
      // Init a new widget
      let widgetOptions = {
        destinationId: destination,
        destinationType: destinationType,
        spaceActivities: {"files":true,"meet":true,"message":true,"people":false},
        initialActivity: destinationType == "email" ? 'message' : 'meet',
        secondaryActivitiesFullWidth: false
      }
      if(userType == "guest"){
        widgetOptions.guestToken = token;
      } else {
        widgetOptions.accessToken = token;
      }
      ciscospark.widget(widgetEl).spaceWidget(widgetOptions);
      document.getElementById('dialog').title = `Hello, ${label}!`;
    </script>

  </body>
</html>
